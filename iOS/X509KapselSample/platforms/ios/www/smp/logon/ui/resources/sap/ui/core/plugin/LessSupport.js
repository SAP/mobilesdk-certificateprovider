/*!
 * SAP UI development toolkit for HTML5 (SAPUI5/OpenUI5)
 * (c) Copyright 2009-2015 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
(function(){function d(){sap.ui.define('sap/ui/core/plugin/LessSupport',['jquery.sap.global','sap/ui/core/Core'],function(q,C){"use strict";var L="library.source";var a="library";var b=function(){};b.prototype.startPlugin=function(c,o){q.sap.log.info("Starting LessSupport plugin.");q.sap.log.warning("  NOT FOR PRODUCTIVE USAGE! LessSupport is an experimental feature which might change in future!");var u=q.sap.getUriParameters();var n=u.get("sap-ui-xx-noless");if(n){n=n.toLowerCase()}try{if(n!=="false"&&(window.top.JsUnit||(window.sap.ui.test&&window.sap.ui.test.qunit))){q.sap.log.info("  LessSupport has been deactivated for JSUnit Testrunner or QUnit.");return}}catch(e){}if(n&&n!=="false"){q.sap.log.info("  LessSupport has been deactivated by URL parameter.");return}else{q.sap.log.info("  LessSupport can be deactivated by adding the following parameter to your URL: \"sap-ui-xx-noless=X\".")}window.less=window.less||{env:"development",errorReporting:function(m,i,r){if(m==="add"&&window.console){window.console.error("Failed to parse: "+r,i)}}};q.sap.require("sap.ui.thirdparty.less");this.oCore=c;this.bActive=true;var T=window.less.tree.Color.prototype.toCSS;window.less.tree.Color.prototype.toCSS=function(){if(this.alpha==0&&this.rgb[0]==0&&this.rgb[1]==0&&this.rgb[2]==0){return"transparent"}return T.apply(this,arguments)};this.oCore.includeLibraryTheme=q.proxy(this.includeLibraryTheme,this);this.oCore.applyTheme=q.proxy(this.applyTheme,this);var f=this,U=false;var l=[];q("link[id^=sap-ui-theme-]").each(function(){var _=f.initLink(this);U=_||U;if(_){l.push(this.id.substr(13))}});this.refreshLess(U);var g=0;function j(){var k=true;var m;for(var i=0;i<l.length;i++){m=sap.ui.core.ThemeCheck.checkStyle("less:"+l[i],true);if(m){q.sap.byId("sap-ui-theme-"+l[i]).attr("sap-ui-ready","true")}k=k&&m}g++;if(g>100){k=true;q.sap.log.warning("LessSupport: Max theme check cycles reached.")}if(k){sap.ui.core.ThemeCheck.themeLoaded=true;q.sap.delayedCall(0,c,"fireThemeChanged",[{theme:c.sTheme}])}else{f.iCheckThemeAppliedTimeout=q.sap.delayedCall(100,null,j)}}if(U){this.iCheckThemeAppliedTimeout=q.sap.delayedCall(100,null,j)}};b.prototype.stopPlugin=function(){q.sap.log.info("Stopping LessSupport plugin.");if(this.bActive){q.sap.delayedCall(this.iCheckThemeAppliedTimeout);delete this.iCheckThemeAppliedTimeout;q("link[id^=sap-ui-theme-]").each(function(){var l=this.id.substr(13);q.sap.byId("less:"+l).remove()});delete this.oCore.includeLibraryTheme;delete this.oCore.applyTheme;this.oCore=null}};b.prototype.initLink=function(l){var u=this.updateLink(l);q("<style>").attr("id","less:"+l.id.substr(13)).attr("type","text/css").attr("media",this.media||"screen").insertAfter(l);return u};b.prototype.updateLink=function(l){var s=l.id.substr(13);var p;if((p=s.indexOf("-["))>0){s=s.substr(0,p)}var B=this.oCore._getThemePath(s,this.oCore.sTheme);var i=this.getLastModified(B+L+".less");var c=this.getLastModified(B+a+".css");var u=i>c;if(!u){var e=this.oCore._getThemePath(s,"base");var f=this.getLastModified(e+L+".less");var g=this.getLastModified(e+a+".css");u=f>g}var F=(u)?L:a;q.sap.log.debug("LessSupport.updateLink: "+B+F+": "+(u?"LESS":"CSS"));if(!u){if(l.title){delete l.title}l.rel="stylesheet";l.href=B+F+".css";this.unregisterLink(l);return false}l.title=s;l.rel="stylesheet/less";l.href=B+F+".less";this.registerLink(l);return true};b.prototype.getLastModified=function(u){var l;q.ajax({url:u,type:"HEAD",async:false,success:function(c,e,x){var s=x.getResponseHeader("Last-Modified");l=s?Date.parse(s):0},error:function(x,c,e){l=-1}});q.sap.log.debug("CSS/LESS head-check: "+u+"; last-modified: "+l);return l};b.prototype.applyTheme=function(T,s){sap.ui.core.Core.prototype.applyTheme.apply(this.oCore,arguments);var c=this,u=false;q("link[id^=sap-ui-theme-]").each(function(){u=c.updateLink(this)||u});this.refreshLess(u)};b.prototype.includeLibraryTheme=function(l){sap.ui.core.Core.prototype.includeLibraryTheme.apply(this.oCore,arguments);var c=this,u=false;q("link[id='sap-ui-theme-"+l+"']").each(function(){u=c.initLink(this)||u});this.refreshLess(u)};b.prototype.registerLink=function(l){if(window.less&&window.less.sheets){var i=q.inArray(l,window.less.sheets);if(i===-1){window.less.sheets.push(l)}}};b.prototype.unregisterLink=function(l){if(window.less&&window.less.sheets){var s=l.id.substr(13);var i=q.inArray(l,window.less.sheets);if(i>=0){window.less.sheets.splice(i,1);q.sap.byId("less:"+s).html("")}}};b.prototype.refreshLess=function(u){if(u){if(!document.getElementById("sap-ui-ide-less-mode")){q("<span>").attr("id","sap-ui-ide-less-mode").css("position","absolute").css("right","10px").css("bottom","10px").css("padding","10px").css("border","3px solid red").css("border-radius","10px").css("opacity","0.75").css("color","black").css("background-color","white").css("font-weight","bold").css("z-index","99999").append(q("<span>").text("LESS MODE").css({"display":"block","text-align":"center"})).append(q("<a>").attr("href","#").text("Deactivate").attr("title","Less mode is active. Click to deactivate it (requires page refresh).").css({"float":"left","clear":"left","font-size":"0.75em","text-decoration":"underline","margin-right":"0.5em"}).bind("click",function(e){e.preventDefault();if(window.confirm("Deactivating the Less Mode refreshes the page. Do you want to proceed?")){var s=window.location.search;window.location.search=(s.charAt(0)==="?"?(s+"&"):"?")+"sap-ui-xx-noless=true"}})).append(q("<a>").attr("href","#").text("Hide").attr("title","Less mode is active. Click to hide this information.").css({"float":"right","font-size":"0.75em","text-decoration":"underline"}).bind("click",function(e){e.preventDefault();q(this).parent().css("display","none")})).appendTo(window.document.body)}}else{q("#sap-ui-ide-less-mode").remove()}if(window.less&&window.less.refresh&&window.less.sheets.length>0){var l={};var m={};q(window.less.sheets).each(function(){m[this.href]=q(this).attr("id").substr(13)});var f=window.less.tree.Rule.prototype.eval;window.less.tree.Rule.prototype.eval=function(e){if(this.variable&&typeof this.name==="string"&&this.name.indexOf("@_PRIVATE_")!==0){var s=m[this.currentFileInfo.rootFilename];if(!s){q.sap.log.warning("LessSupport: could not find libary ("+this.currentFileInfo.rootFilename+")")}var v=l[s];if(!v){v=l[s]={}}try{v[this.name.substr(1)]=this.value.eval(e).toCSS(e)}catch(c){}}return f.apply(this,arguments)};window.less.refresh();q.sap.require("sap.ui.core.theming.Parameters");sap.ui.core.theming.Parameters._setOrLoadParameters(l);window.less.tree.Rule.prototype.eval=f}};var t=new b();sap.ui.getCore().registerPlugin(t);b.refresh=function(){t.refreshLess(true);if(t.oCore.oThemeCheck){t.oCore.oThemeCheck.fireThemeChangedEvent(false,true)}};return b},true)}if(!(window.sap&&window.sap.ui&&window.sap.ui.define)){var h;if(document.addEventListener){h=function(){document.removeEventListener("DOMContentLoaded",h,false);d()};document.addEventListener("DOMContentLoaded",h,false)}else if(document.attachEvent){h=function(){document.detachEvent("onreadystatechange",h);d()};document.attachEvent("onreadystatechange",h)}}else{d()}}());
