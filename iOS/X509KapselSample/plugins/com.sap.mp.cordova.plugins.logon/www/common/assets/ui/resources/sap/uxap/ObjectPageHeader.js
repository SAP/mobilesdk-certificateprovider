/*!
 * SAP.${maven.build.timestamp} UI development toolkit for HTML5 (SAPUI5) (c) Copyright
 * 		2009-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.uxap.ObjectPageHeader");jQuery.sap.require("sap.uxap.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.uxap.ObjectPageHeader",{metadata:{library:"sap.uxap",properties:{"objectImageURI":{type:"string",group:"",defaultValue:null},"objectImageAlt":{type:"string",group:"",defaultValue:''},"objectImageDensityAware":{type:"boolean",group:"",defaultValue:false},"objectTitle":{type:"string",group:"",defaultValue:null},"objectSubtitle":{type:"string",group:"",defaultValue:null},"objectImageShape":{type:"sap.uxap.ObjectPageHeaderPictureShape",group:"",defaultValue:sap.uxap.ObjectPageHeaderPictureShape.Square},"isObjectIconAlwaysVisible":{type:"boolean",group:"",defaultValue:false},"isObjectTitleAlwaysVisible":{type:"boolean",group:"",defaultValue:true},"isObjectSubtitleAlwaysVisible":{type:"boolean",group:"",defaultValue:true},"isActionAreaAlwaysVisible":{type:"boolean",group:"",defaultValue:true},"headerDesign":{type:"sap.uxap.ObjectPageHeaderDesign",group:"",defaultValue:sap.uxap.ObjectPageHeaderDesign.Light}},aggregations:{"_overflowButton":{type:"sap.m.Button",multiple:false,visibility:"hidden"},"_objectImage":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},"navigationBar":{type:"sap.m.Bar",multiple:false},"actions":{type:"sap.ui.core.Control",multiple:true,singularName:"action"}}}});
sap.uxap.ObjectPageHeader.prototype.init=function(){var o=new sap.m.ActionSheet({placement:"Bottom"});this._oOverflowButton=new sap.m.Button({icon:"sap-icon://overflow",type:sap.m.ButtonType.Transparent,press:function(){o.openBy(this)}});this._oOverflowActionSheet=o;this.setAggregation("_overflowButton",this._oOverflowButton);this._oActionSheetButtonMap={};this._iResizeId=sap.ui.core.ResizeHandler.register(this,jQuery.proxy(this._adaptLayout,this))};
sap.uxap.ObjectPageHeader.prototype.setHeaderDesign=function(h){this.setProperty("headerDesign",h);if(this.getParent()){this.getParent().invalidate()}};
sap.uxap.ObjectPageHeader.prototype.onBeforeRendering=function(){var o=this.getObjectImageURI();if(o.indexOf("sap-icon://")==0){this._oObjectImage=new sap.ui.core.Icon()}else{this._oObjectImage=new sap.m.Image();this._oObjectImage.setDensityAware(this.getObjectImageDensityAware());this._oObjectImage.setAlt(this.getObjectImageAlt())}this._oObjectImage.setSrc(o);this._oObjectImage.addStyleClass("sapUxAPObjectPageHeaderObjectImage");this.setAggregation("_objectImage",this._oObjectImage,true);var a=this.getActions()||[];this._oOverflowActionSheet.removeAllButtons();this._oActionSheetButtonMap={};if(a.length>1||this._hasOneButtonShowText(a)){jQuery.each(a,jQuery.proxy(function(i,A){if(A instanceof sap.m.Button&&A.getVisible()){A.setProperty("type",sap.m.ButtonType.Transparent,false);var b=this._createActionSheetButton(A);this._oActionSheetButtonMap[A.getId()]=b;this._oOverflowActionSheet.addButton(b)}},this))}};
sap.uxap.ObjectPageHeader.prototype._createActionSheetButton=function(b){var c=new sap.m.Button({press:jQuery.proxy(this._onSeeMoreContentSelect,this),customData:new sap.ui.core.CustomData({key:"originalId",value:b.getId()})});var t=b.getBindingInfo("text"),i=b.getBindingInfo("icon"),m;if(t&&t.parts&&t.parts.length>0){m=t.parts[0].model;c.bindProperty("text",{path:t.parts[0].path,model:m,formatter:t.formatter});c.setBindingContext(b.getBindingContext(m),m);c.setModel(b.getModel(m),m)}else{c.setText(b.getText())}if(i&&i.parts&&i.parts.length>0){m=i.parts[0].model;c.bindProperty("icon",{path:i.parts[0].path,model:m,formatter:i.formatter});c.setBindingContext(b.getBindingContext(m),m);c.setModel(b.getModel(m),m)}else{c.setIcon(b.getIcon())}return c};
sap.uxap.ObjectPageHeader.prototype.onAfterRendering=function(){this._oOverflowButton.$().hide();jQuery.sap.delayedCall(50,this,this._adaptLayout)};
sap.uxap.ObjectPageHeader.prototype._onSeeMoreContentSelect=function(e){var p=e.getSource(),o;o=sap.ui.getCore().byId(p.data("originalId"));if(o.firePress){o.firePress({overflowButtonId:this._oOverflowButton.getId()})}this._oOverflowActionSheet.close()};
sap.uxap.ObjectPageHeader.prototype._hasOneButtonShowText=function(a){var o=false;if(a.length==1){if(a[0]instanceof sap.uxap.ObjectPageHeaderActionButton){o=(!a[0].getHideText()&&a[0].getText()!="")}else if(a[0]instanceof sap.m.Button){o=(a[0].getText()!="")}}return o};
sap.uxap.ObjectPageHeader.prototype._adaptLayout=function(){var t=(new Date()).getTime();jQuery.sap.measure.start("UxAP :: ObjectPageHeader._adaptLayout_"+t,"actions responsiveness");var a=this.getActions()||[];this._oOverflowButton.$().hide();if(a.length>1||this._hasOneButtonShowText(a)){var o=this._oOverflowButton.$().width(),A=this.$("identifierLine").width()-this.$("identifierLineContainer").width()-this._oObjectImage.$().width(),i=A-2*o,c=0,m=jQuery("html").hasClass("sapUiMedia-Std-Phone")||sap.ui.Device.system.phone;jQuery.each(a,jQuery.proxy(function(I,b){c+=b.$().width();b.$().show();if(this._oActionSheetButtonMap[b.getId()]){this._oActionSheetButtonMap[b.getId()].setVisible(false);if(c>=i||m){b.$().hide();this._oActionSheetButtonMap[b.getId()].setVisible(true)}}return true},this));if(c>=i||m){this._oOverflowButton.$().show()}}jQuery.sap.measure.end("UxAP :: ObjectPageHeader._adaptLayout_"+t,"actions responsiveness")};
